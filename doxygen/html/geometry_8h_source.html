<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Godot: core/math/geometry.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Godot
   </div>
   <div id="projectbrief">Game Engine MIT</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4270bfced15e0e73154b13468c7c9ad9.html">core</a></li><li class="navelem"><a class="el" href="dir_e07ac01d65d17e829451634057f91345.html">math</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">geometry.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*************************************************************************/</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*  geometry.h                                                           */</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/*************************************************************************/</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">/*                       This file is part of:                           */</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">/*                           GODOT ENGINE                                */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/*                    http://www.godotengine.org                         */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/*************************************************************************/</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">/* Copyright (c) 2007-2015 Juan Linietsky, Ariel Manzur.                 */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/*                                                                       */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/* Permission is hereby granted, free of charge, to any person obtaining */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/* a copy of this software and associated documentation files (the       */</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/* &quot;Software&quot;), to deal in the Software without restriction, including   */</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/* without limitation the rights to use, copy, modify, merge, publish,   */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/* distribute, sublicense, and/or sell copies of the Software, and to    */</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/* permit persons to whom the Software is furnished to do so, subject to */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/* the following conditions:                                             */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/*                                                                       */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/* The above copyright notice and this permission notice shall be        */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/* included in all copies or substantial portions of the Software.       */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/*                                                                       */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/* THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,       */</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF    */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.*/</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/* IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY  */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/* CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,  */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/* TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE     */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/* SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.                */</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/*************************************************************************/</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#ifndef GEOMETRY_H</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#define GEOMETRY_H</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;vector3.h&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;face3.h&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;dvector.h&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;math_2d.h&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;vector.h&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;print_string.h&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;object.h&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;triangulate.h&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_geometry.html">   44</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_geometry.html">Geometry</a> {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="class_geometry.html">Geometry</a>();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> get_closest_points_between_segments( <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p1,<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; q1, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p2,<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; q2, <a class="code" href="struct_vector2.html">Vector2</a>&amp; c1, <a class="code" href="struct_vector2.html">Vector2</a>&amp; c2) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> d1 = q1 - p1; <span class="comment">// Direction vector of segment S1</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> d2 = q2 - p2; <span class="comment">// Direction vector of segment S2</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> r = p1 - p2;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keywordtype">float</span> a = d1.dot(d1); <span class="comment">// Squared length of segment S1, always nonnegative</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordtype">float</span> e = d2.dot(d2); <span class="comment">// Squared length of segment S2, always nonnegative</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordtype">float</span> f = d2.dot(r);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordtype">float</span> s,t;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="comment">// Check if either or both segments degenerate into points</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">if</span> (a &lt;= CMP_EPSILON &amp;&amp; e &lt;= CMP_EPSILON) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="comment">// Both segments degenerate into points</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            c1 = p1;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            c2 = p2;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">return</span> Math::sqrt((c1 - c2).dot(c1 - c2));</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">if</span> (a &lt;= CMP_EPSILON) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="comment">// First segment degenerates into a point</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            s = 0.0f;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            t = f / e; <span class="comment">// s = 0 =&gt; t = (b*s + f) / e = f / e</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            t = CLAMP(t, 0.0f, 1.0f);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordtype">float</span> c = d1.dot(r);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">if</span> (e &lt;= CMP_EPSILON) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="comment">// Second segment degenerates into a point</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                t = 0.0f;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                s = CLAMP(-c / a, 0.0f, 1.0f); <span class="comment">// t = 0 =&gt; s = (b*t - c) / a = -c / a</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                <span class="comment">// The general nondegenerate case starts here</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                <span class="keywordtype">float</span> b = d1.dot(d2);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <span class="keywordtype">float</span> denom = a*e-b*b; <span class="comment">// Always nonnegative</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="comment">// If segments not parallel, compute closest point on L1 to L2 and</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                <span class="comment">// clamp to segment S1. Else pick arbitrary s (here 0)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                <span class="keywordflow">if</span> (denom != 0.0f) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                    s = CLAMP((b*f - c*e) / denom, 0.0f, 1.0f);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                    s = 0.0f;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="comment">// Compute point on L2 closest to S1(s) using</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="comment">// t = Dot((P1 + D1*s) - P2,D2) / Dot(D2,D2) = (b*s + f) / e</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                t = (b*s + f) / e;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="comment">//If t in [0,1] done. Else clamp t, recompute s for the new value</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="comment">// of t using s = Dot((P2 + D2*t) - P1,D1) / Dot(D1,D1)= (t*b - c) / a</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="comment">// and clamp s to [0, 1]</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="keywordflow">if</span> (t &lt; 0.0f) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    t = 0.0f;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    s = CLAMP(-c / a, 0.0f, 1.0f);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t &gt; 1.0f) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    t = 1.0f;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    s = CLAMP((b - c) / a, 0.0f, 1.0f);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        c1 = p1 + d1 * s;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        c2 = p2 + d2 * t;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">return</span> Math::sqrt((c1 - c2).dot(c1 - c2));</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> get_closest_points_between_segments(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p1,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p2,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; q1,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; q2,<a class="code" href="struct_vector3.html">Vector3</a>&amp; c1, <a class="code" href="struct_vector3.html">Vector3</a>&amp; c2)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">//do the function &#39;d&#39; as defined by pb. I think is is dot product of some sort</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#define d_of(m,n,o,p) ( (m.x - n.x) * (o.x - p.x) + (m.y - n.y) * (o.y - p.y) + (m.z - n.z) * (o.z - p.z) )</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment">//caluclate the parpametric position on the 2 curves, mua and mub</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordtype">float</span> mua = ( d_of(p1,q1,q2,q1) * d_of(q2,q1,p2,p1)  - d_of(p1,q1,p2,p1) * d_of(q2,q1,q2,q1) ) / ( d_of(p2,p1,p2,p1) * d_of(q2,q1,q2,q1)  - d_of(q2,q1,p2,p1) * d_of(q2,q1,p2,p1) );</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordtype">float</span> mub = ( d_of(p1,q1,q2,q1) + mua * d_of(q2,q1,p2,p1)  ) / d_of(q2,q1,q2,q1);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="comment">//clip the value between [0..1] constraining the solution to lie on the original curves</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">if</span> (mua &lt; 0) mua = 0;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> (mub &lt; 0) mub = 0;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span> (mua &gt; 1) mua = 1;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">if</span> (mub &gt; 1) mub = 1;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        c1 = p1.linear_interpolate(p2,mua);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        c2 = q1.linear_interpolate(q2,mub);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> get_closest_distance_between_segments( <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_from_a,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_to_a, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_from_b,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_to_b) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a>   u = p_to_a - p_from_a;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a>   v = p_to_b - p_from_b;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a>   w = p_from_a - p_to_a;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        real_t    a = u.dot(u);        <span class="comment">// always &gt;= 0</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        real_t    b = u.dot(v);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        real_t    c = v.dot(v);        <span class="comment">// always &gt;= 0</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        real_t    d = u.dot(w);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        real_t    e = v.dot(w);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        real_t    D = a*c - b*b;       <span class="comment">// always &gt;= 0</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        real_t    sc, sN, sD = D;      <span class="comment">// sc = sN / sD, default sD = D &gt;= 0</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        real_t    tc, tN, tD = D;      <span class="comment">// tc = tN / tD, default tD = D &gt;= 0</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// compute the line parameters of the two closest points</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">if</span> (D &lt; CMP_EPSILON) { <span class="comment">// the lines are almost parallel</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        sN = 0.0;        <span class="comment">// force using point P0 on segment S1</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        sD = 1.0;        <span class="comment">// to prevent possible division by 0.0 later</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        tN = e;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        tD = c;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">else</span> {                <span class="comment">// get the closest points on the infinite lines</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        sN = (b*e - c*d);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        tN = (a*e - b*d);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> (sN &lt; 0.0) {       <span class="comment">// sc &lt; 0 =&gt; the s=0 edge is visible</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            sN = 0.0;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            tN = e;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            tD = c;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sN &gt; sD) {  <span class="comment">// sc &gt; 1 =&gt; the s=1 edge is visible</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            sN = sD;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            tN = e + b;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            tD = c;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">if</span> (tN &lt; 0.0) {           <span class="comment">// tc &lt; 0 =&gt; the t=0 edge is visible</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        tN = 0.0;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="comment">// recompute sc for this edge</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">if</span> (-d &lt; 0.0)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            sN = 0.0;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (-d &gt; a)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            sN = sD;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            sN = -d;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            sD = a;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tN &gt; tD) {      <span class="comment">// tc &gt; 1 =&gt; the t=1 edge is visible</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        tN = tD;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment">// recompute sc for this edge</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> ((-d + b) &lt; 0.0)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            sN = 0;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-d + b) &gt; a)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            sN = sD;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            sN = (-d + b);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            sD = a;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// finally do the division to get sc and tc</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        sc = (Math::abs(sN) &lt; CMP_EPSILON ? 0.0 : sN / sD);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        tc = (Math::abs(tN) &lt; CMP_EPSILON ? 0.0 : tN / tD);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="comment">// get the difference of the two closest points</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a>   dP = w + (sc * u) - (tc * v);  <span class="comment">// = S1(sc) - S2(tc)</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">return</span> dP.length();   <span class="comment">// return the closest distance</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> ray_intersects_triangle( <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_from, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_dir, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v0,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v1,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v2,<a class="code" href="struct_vector3.html">Vector3</a>* r_res=0) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> e1=p_v1-p_v0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> e2=p_v2-p_v0;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> h = p_dir.cross(e2);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        real_t a =e1.dot(h);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> (a&gt;-CMP_EPSILON &amp;&amp; a &lt; CMP_EPSILON) <span class="comment">// parallel test</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        real_t f=1.0/a;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> s=p_from-p_v0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        real_t u = f * s.dot(h);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span> ( u&lt; 0.0 || u &gt; 1.0)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> q=s.cross(e1);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        real_t v = f * p_dir.dot(q);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">if</span> (v &lt; 0.0 || u + v &gt; 1.0)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">// at this stage we can compute t to find out where </span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">// the intersection point is on the line</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        real_t t = f * e2.dot(q);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">if</span> (t &gt; 0.00001) {<span class="comment">// ray intersection</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">if</span> (r_res)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                *r_res=p_from+p_dir*t;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        } <span class="keywordflow">else</span> <span class="comment">// this means that there is a line intersection  </span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="comment">// but not a ray intersection</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }   </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> segment_intersects_triangle( <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_from, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_to, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v0,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v1,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v2,<a class="code" href="struct_vector3.html">Vector3</a>* r_res=0) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> rel=p_to-p_from;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> e1=p_v1-p_v0;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> e2=p_v2-p_v0;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> h = rel.cross(e2);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        real_t a =e1.dot(h);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">if</span> (a&gt;-CMP_EPSILON &amp;&amp; a &lt; CMP_EPSILON) <span class="comment">// parallel test</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        real_t f=1.0/a;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> s=p_from-p_v0;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        real_t u = f * s.dot(h);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">if</span> ( u&lt; 0.0 || u &gt; 1.0)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> q=s.cross(e1);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        real_t v = f * rel.dot(q);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> (v &lt; 0.0 || u + v &gt; 1.0)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">// at this stage we can compute t to find out where </span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">// the intersection point is on the line</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        real_t t = f * e2.dot(q);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">if</span> (t &gt; CMP_EPSILON &amp;&amp; t&lt;=1.0) {<span class="comment">// ray intersection</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">if</span> (r_res)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                *r_res=p_from+rel*t;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        } <span class="keywordflow">else</span> <span class="comment">// this means that there is a line intersection  </span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="comment">// but not a ray intersection</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }   </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> segment_intersects_sphere( <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_from, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_to, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_sphere_pos,real_t p_sphere_radius,<a class="code" href="struct_vector3.html">Vector3</a>* r_res=0,<a class="code" href="struct_vector3.html">Vector3</a> *r_norm=0) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> sphere_pos=p_sphere_pos-p_from;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> rel=(p_to-p_from);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordtype">float</span>  rel_l=rel.length();</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordflow">if</span> (rel_l&lt;CMP_EPSILON)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// both points are the same</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> normal=rel/rel_l;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordtype">float</span> sphere_d=normal.dot(sphere_pos);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment">//Vector3 ray_closest=normal*sphere_d;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordtype">float</span> ray_distance=sphere_pos.distance_to(normal*sphere_d);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">if</span> (ray_distance&gt;=p_sphere_radius)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordtype">float</span> inters_d2=p_sphere_radius*p_sphere_radius - ray_distance*ray_distance;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordtype">float</span> inters_d=sphere_d;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">if</span> (inters_d2&gt;=CMP_EPSILON)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            inters_d-=Math::sqrt(inters_d2);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="comment">// check in segment</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">if</span> (inters_d&lt;0 || inters_d&gt;rel_l)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> result=p_from+normal*inters_d;;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> (r_res)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            *r_res=result;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">if</span> (r_norm)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            *r_norm=(result-p_sphere_pos).normalized();</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> segment_intersects_cylinder( <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_from, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_to, <span class="keywordtype">float</span> p_height,<span class="keywordtype">float</span> p_radius,<a class="code" href="struct_vector3.html">Vector3</a>* r_res=0,<a class="code" href="struct_vector3.html">Vector3</a> *r_norm=0) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> rel=(p_to-p_from);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordtype">float</span>  rel_l=rel.length();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> (rel_l&lt;CMP_EPSILON)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// both points are the same</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="comment">// first check if they are parallel</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> normal=(rel/rel_l);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> crs = normal.cross(<a class="code" href="struct_vector3.html">Vector3</a>(0,0,1));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordtype">float</span> crs_l=crs.length();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> z_dir;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">if</span>(crs_l&lt;CMP_EPSILON) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">//blahblah parallel</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            z_dir=<a class="code" href="struct_vector3.html">Vector3</a>(1,0,0); <span class="comment">//any x/y vector ok</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            z_dir=crs/crs_l;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordtype">float</span> dist=z_dir.dot(p_from);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (dist&gt;=p_radius)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// too far away</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="comment">// convert to 2D</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordtype">float</span> w2=p_radius*p_radius-dist*dist;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">if</span> (w2&lt;CMP_EPSILON)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//avoid numerical error</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <a class="code" href="struct_vector2.html">Size2</a> size(Math::sqrt(w2),p_height*0.5);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> x_dir=z_dir.cross(<a class="code" href="struct_vector3.html">Vector3</a>(0,0,1)).normalized();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> from2D(x_dir.dot(p_from),p_from.z);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> to2D(x_dir.dot(p_to),p_to.z);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordtype">float</span> min=0,max=1;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordtype">int</span> axis=-1;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;2;i++) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            real_t seg_from=from2D[i];</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            real_t seg_to=to2D[i];</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            real_t box_begin=-size[i];</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            real_t box_end=size[i];</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            real_t cmin,cmax;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">if</span> (seg_from &lt; seg_to) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="keywordflow">if</span> (seg_from &gt; box_end || seg_to &lt; box_begin)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                real_t length=seg_to-seg_from;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                cmin = (seg_from &lt; box_begin)?((box_begin - seg_from)/length):0;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                cmax = (seg_to &gt; box_end)?((box_end - seg_from)/length):1;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <span class="keywordflow">if</span> (seg_to &gt; box_end || seg_from &lt; box_begin)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                real_t length=seg_to-seg_from;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                cmin = (seg_from &gt; box_end)?(box_end - seg_from)/length:0;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                cmax = (seg_to &lt; box_begin)?(box_begin - seg_from)/length:1;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">if</span> (cmin &gt; min) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                min = cmin;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                axis=i;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">if</span> (cmax &lt; max)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                max = cmax;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keywordflow">if</span> (max &lt; min)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="comment">// convert to 3D again</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> result = p_from + (rel*min);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> res_normal = result;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">if</span> (axis==0) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            res_normal.z=0;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            res_normal.x=0;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            res_normal.y=0;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        res_normal.normalize();</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span> (r_res)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            *r_res=result;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">if</span> (r_norm)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            *r_norm=res_normal;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> segment_intersects_convex(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_from, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_to,<span class="keyword">const</span> <a class="code" href="class_plane.html">Plane</a>* p_planes, <span class="keywordtype">int</span> p_plane_count,<a class="code" href="struct_vector3.html">Vector3</a> *p_res, <a class="code" href="struct_vector3.html">Vector3</a> *p_norm) {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        real_t min=-1e20,max=1e20;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> rel=p_to-p_from;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        real_t rel_l=rel.length();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span> (rel_l&lt;CMP_EPSILON)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> dir=rel/rel_l;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordtype">int</span> min_index=-1;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;p_plane_count;i++) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="keyword">const</span> <a class="code" href="class_plane.html">Plane</a>&amp;p=p_planes[i];</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            real_t den=p.normal.dot( dir );</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="comment">//printf(&quot;den is %i\n&quot;,den);</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="keywordflow">if</span> (Math::abs(den)&lt;=CMP_EPSILON)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                <span class="keywordflow">continue</span>; <span class="comment">// ignore parallel plane</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            real_t dist=-p.distance_to(p_from ) / den;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keywordflow">if</span> (den&gt;0) {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                <span class="comment">//backwards facing plane</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                <span class="keywordflow">if</span> (dist&lt;max)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                    max=dist;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="comment">//front facing plane</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">if</span> (dist&gt;min) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                    min=dist;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    min_index=i;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">if</span> (max&lt;=min || min&lt;0 || min&gt;rel_l || min_index==-1) <span class="comment">// exit conditions</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no intersection</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span> (p_res)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            *p_res=p_from+dir*min;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">if</span> (p_norm)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            *p_norm=p_planes[min_index].normal;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keyword">static</span> <a class="code" href="struct_vector3.html">Vector3</a> get_closest_point_to_segment(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_point, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a> *p_segment) {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> p=p_point-p_segment[0];</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> n=p_segment[1]-p_segment[0];</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordtype">float</span> l =n.length();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">if</span> (l&lt;1e-10)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">return</span> p_segment[0]; <span class="comment">// both points are the same, just give any</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        n/=l;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordtype">float</span> d=n.dot(p);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keywordflow">if</span> (d&lt;=0.0)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keywordflow">return</span> p_segment[0]; <span class="comment">// before first point</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d&gt;=l)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="keywordflow">return</span> p_segment[1]; <span class="comment">// after first point</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordflow">return</span> p_segment[0]+n*d; <span class="comment">// inside</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keyword">static</span> <a class="code" href="struct_vector3.html">Vector3</a> get_closest_point_to_segment_uncapped(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_point, <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a> *p_segment) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> p=p_point-p_segment[0];</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> n=p_segment[1]-p_segment[0];</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordtype">float</span> l =n.length();</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">if</span> (l&lt;1e-10)</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">return</span> p_segment[0]; <span class="comment">// both points are the same, just give any</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        n/=l;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordtype">float</span> d=n.dot(p);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">return</span> p_segment[0]+n*d; <span class="comment">// inside</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keyword">static</span> <a class="code" href="struct_vector2.html">Vector2</a> get_closest_point_to_segment_2d(<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_point, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a> *p_segment) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> p=p_point-p_segment[0];</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> n=p_segment[1]-p_segment[0];</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordtype">float</span> l =n.length();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> (l&lt;1e-10)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keywordflow">return</span> p_segment[0]; <span class="comment">// both points are the same, just give any</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        n/=l;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordtype">float</span> d=n.dot(p);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span> (d&lt;=0.0)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="keywordflow">return</span> p_segment[0]; <span class="comment">// before first point</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d&gt;=l)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            <span class="keywordflow">return</span> p_segment[1]; <span class="comment">// after first point</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="keywordflow">return</span> p_segment[0]+n*d; <span class="comment">// inside</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> is_point_in_triangle(<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; s, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; a, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; b, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; c)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordtype">int</span> as_x = s.x-a.x;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordtype">int</span> as_y = s.y-a.y;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordtype">bool</span> s_ab = (b.x-a.x)*as_y-(b.y-a.y)*as_x &gt; 0;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span>(((c.x-a.x)*as_y-(c.y-a.y)*as_x &gt; 0) == s_ab) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">if</span>(((c.x-b.x)*(s.y-b.y)-(c.y-b.y)*(s.x-b.x) &gt; 0) != s_ab) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keyword">static</span> <a class="code" href="struct_vector2.html">Vector2</a> get_closest_point_to_segment_uncapped_2d(<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_point, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a> *p_segment) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> p=p_point-p_segment[0];</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> n=p_segment[1]-p_segment[0];</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordtype">float</span> l =n.length();</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">if</span> (l&lt;1e-10)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordflow">return</span> p_segment[0]; <span class="comment">// both points are the same, just give any</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        n/=l;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordtype">float</span> d=n.dot(p);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">return</span> p_segment[0]+n*d; <span class="comment">// inside</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> segment_intersects_segment_2d(<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_from_a,<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_to_a,<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_from_b,<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_to_b,<a class="code" href="struct_vector2.html">Vector2</a>* r_result) {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> B = p_to_a-p_from_a;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> C = p_from_b-p_from_a;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> D = p_to_b-p_from_a;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        real_t ABlen = B.dot(B);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">if</span> (ABlen&lt;=0)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="struct_vector2.html">Vector2</a> Bn = B/ABlen;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        C = <a class="code" href="struct_vector2.html">Vector2</a>( C.x*Bn.x + C.y*Bn.y, C.y*Bn.x - C.x*Bn.y );</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        D = <a class="code" href="struct_vector2.html">Vector2</a>( D.x*Bn.x + D.y*Bn.y, D.y*Bn.x - D.x*Bn.y );</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">if</span> ((C.y&lt;0 &amp;&amp; D.y&lt;0) || (C.y&gt;=0 &amp;&amp; D.y&gt;=0))</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordtype">float</span> ABpos=D.x+(C.x-D.x)*D.y/(D.y-C.y);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="comment">//  Fail if segment C-D crosses line A-B outside of segment A-B.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">if</span> (ABpos&lt;0 || ABpos&gt;1.0)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="comment">//  (4) Apply the discovered position to line A-B in the original coordinate system.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span> (r_result)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            *r_result=p_from_a+B*ABpos;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> point_in_projected_triangle(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_point,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v1,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v2,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_v3) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> face_n =  (p_v1-p_v3).cross(p_v1-p_v2);     </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> n1 =  (p_point-p_v3).cross(p_point-p_v2);       </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">if</span> (face_n.dot(n1)&lt;0)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> n2 =  (p_v1-p_v3).cross(p_v1-p_point);      </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span> (face_n.dot(n2)&lt;0)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> n3 =  (p_v1-p_point).cross(p_v1-p_v2);      </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">if</span> (face_n.dot(n3)&lt;0)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno"><a class="line" href="class_geometry.html#a0360ea9aa69ddd199d8fe0dc77938b80">  596</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="class_geometry.html#a0360ea9aa69ddd199d8fe0dc77938b80">triangle_sphere_intersection_test</a>(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a> *p_triangle,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_normal,<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_sphere_pos, real_t p_sphere_radius,<a class="code" href="struct_vector3.html">Vector3</a>&amp; r_triangle_contact,<a class="code" href="struct_vector3.html">Vector3</a>&amp; r_sphere_contact) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordtype">float</span> d=p_normal.dot(p_sphere_pos)-p_normal.dot(p_triangle[0]);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">if</span> (d &gt; p_sphere_radius || d &lt; -p_sphere_radius) <span class="comment">// not touching the plane of the face, return</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <a class="code" href="struct_vector3.html">Vector3</a> contact=p_sphere_pos - (p_normal*d);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span> (Geometry::point_in_projected_triangle(contact,p_triangle[0],p_triangle[1],p_triangle[2])) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            r_triangle_contact=contact;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            r_sphere_contact=p_sphere_pos-p_normal*p_sphere_radius;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="comment">//printf(&quot;solved inside triangle\n&quot;);</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a> verts[4]={p_triangle[0],p_triangle[1],p_triangle[2],p_triangle[0]}; <span class="comment">// for() friendly</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="comment">// check edge cylinder</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <a class="code" href="struct_vector3.html">Vector3</a> n1=verts[i]-verts[i+1];</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <a class="code" href="struct_vector3.html">Vector3</a> n2=p_sphere_pos-verts[i+1];</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="comment">// check point within cylinder radius</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <a class="code" href="struct_vector3.html">Vector3</a> axis =n1.cross(n2).cross(n1);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            axis.normalize(); <span class="comment">// ugh</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordtype">float</span> ad=axis.dot(n2);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="arch_8h.html#a996f7be338ccb40d1a2a5abc1ad61759">ABS</a>(ad)&gt;p_sphere_radius) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="comment">// no chance with this edge, too far away</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="comment">// check point within edge capsule cylinder</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"></span>            <span class="keywordtype">float</span> sphere_at = n1.dot(n2);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <span class="keywordflow">if</span> (sphere_at&gt;=0 &amp;&amp; sphere_at&lt;n1.dot(n1)) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                r_triangle_contact=p_sphere_pos-axis*(axis.dot(n2));</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                r_sphere_contact=p_sphere_pos-axis*p_sphere_radius;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                <span class="comment">// point inside here</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                <span class="comment">//printf(&quot;solved inside edge\n&quot;);</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <span class="keywordtype">float</span> r2=p_sphere_radius*p_sphere_radius;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordflow">if</span> (n2.length_squared()&lt;r2) {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                <a class="code" href="struct_vector3.html">Vector3</a> n=(p_sphere_pos-verts[i+1]).normalized();</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <span class="comment">//r_triangle_contact=verts[i+1]+n*p_sphere_radius;p_sphere_pos+axis*(p_sphere_radius-axis.dot(n2));</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                r_triangle_contact=verts[i+1];</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                r_sphere_contact=p_sphere_pos-n*p_sphere_radius;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                <span class="comment">//printf(&quot;solved inside point segment 1\n&quot;);</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            <span class="keywordflow">if</span> (n2.distance_squared_to(n1)&lt;r2) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                <a class="code" href="struct_vector3.html">Vector3</a> n=(p_sphere_pos-verts[i]).normalized();</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="comment">//r_triangle_contact=verts[i]+n*p_sphere_radius;p_sphere_pos+axis*(p_sphere_radius-axis.dot(n2));</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                r_triangle_contact=verts[i];</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                r_sphere_contact=p_sphere_pos-n*p_sphere_radius;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="comment">//printf(&quot;solved inside point segment 1\n&quot;);</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="keywordflow">break</span>; <span class="comment">// It&#39;s pointless to continue at this point, so save some cpu cycles</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keyword">static</span> real_t segment_intersects_circle(<span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_from, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_to, <span class="keyword">const</span> <a class="code" href="struct_vector2.html">Vector2</a>&amp; p_circle_pos, real_t p_circle_radius) {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <a class="code" href="struct_vector2.html">Vector2</a> line_vec = p_to - p_from;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <a class="code" href="struct_vector2.html">Vector2</a> vec_to_line = p_from - p_circle_pos;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <span class="comment">/* create a quadratic formula of the form ax^2 + bx + c = 0 */</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            real_t a, b, c;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            a = line_vec.dot(line_vec);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            b = 2 * vec_to_line.dot(line_vec);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            c = vec_to_line.dot(vec_to_line) - p_circle_radius * p_circle_radius;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="comment">/* solve for t */</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            real_t sqrtterm = b*b - 4*a*c;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="comment">/* if the term we intend to square root is less than 0 then the answer won&#39;t be real, so it definitely won&#39;t be t in the range 0 to 1 */</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">if</span>(sqrtterm &lt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="comment">/* if we can assume that the line segment starts outside the circle (e.g. for continuous time collision detection) then the following can be skipped and we can just return the equivalent of res1 */</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            sqrtterm = Math::sqrt(sqrtterm);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            real_t res1 = ( -b - sqrtterm ) / (2 * a);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="comment">//real_t res2 = ( -b + sqrtterm ) / (2 * a);</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="keywordflow">return</span>  (res1 &gt;= 0 &amp;&amp; res1 &lt;= 1) ? res1 : -1;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="class_vector.html">Vector&lt;Vector3&gt;</a> clip_polygon(<span class="keyword">const</span> <a class="code" href="class_vector.html">Vector&lt;Vector3&gt;</a>&amp; polygon,<span class="keyword">const</span> <a class="code" href="class_plane.html">Plane</a>&amp; p_plane) {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keyword">enum</span> LocationCache {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            LOC_INSIDE=1,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            LOC_BOUNDARY=0,</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            LOC_OUTSIDE=-1</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        };</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">if</span> (polygon.size()==0)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">return</span> polygon;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordtype">int</span> *location_cache = (<span class="keywordtype">int</span>*)alloca(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*polygon.size());</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordtype">int</span> inside_count = 0;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordtype">int</span> outside_count = 0;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a = 0; a &lt; polygon.size(); a++) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="comment">//float p_plane.d = (*this) * polygon[a];</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordtype">float</span> dist = p_plane.distance_to(polygon[a]);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">if</span> (dist &lt;-CMP_POINT_IN_PLANE_EPSILON) {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                location_cache[a] = LOC_INSIDE;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                inside_count++;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                <span class="keywordflow">if</span> (dist &gt; CMP_POINT_IN_PLANE_EPSILON) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    location_cache[a] = LOC_OUTSIDE;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    outside_count++;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                    location_cache[a] = LOC_BOUNDARY;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">if</span> (outside_count == 0) {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordflow">return</span> polygon; <span class="comment">// no changes</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inside_count == 0) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_vector.html">Vector&lt;Vector3&gt;</a>(); <span class="comment">//empty</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">//      long count = 0;</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordtype">long</span> previous = polygon.size() - 1;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <a class="code" href="class_vector.html">Vector&lt;Vector3&gt;</a> clipped;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; polygon.size(); index++) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordtype">int</span> loc = location_cache[index];</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">if</span> (loc == LOC_OUTSIDE) {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                <span class="keywordflow">if</span> (location_cache[previous] == LOC_INSIDE) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                    <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; v1 = polygon[previous];</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                    <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; v2 = polygon[index];</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    <a class="code" href="struct_vector3.html">Vector3</a> segment= v1 - v2;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    <span class="keywordtype">double</span> den=p_plane.normal.dot( segment );</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                    <span class="keywordtype">double</span> dist=p_plane.distance_to( v1 ) / den;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    dist=-dist;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                    clipped.push_back( v1 + segment * dist );</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; v1 = polygon[index];</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="keywordflow">if</span> ((loc == LOC_INSIDE) &amp;&amp; (location_cache[previous] == LOC_OUTSIDE)) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                    <span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; v2 = polygon[previous];</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                    <a class="code" href="struct_vector3.html">Vector3</a> segment= v1 - v2;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                    <span class="keywordtype">double</span> den=p_plane.normal.dot( segment );</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                    <span class="keywordtype">double</span> dist=p_plane.distance_to( v1 ) / den;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                    dist=-dist;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                    clipped.push_back( v1 + segment * dist );</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                clipped.push_back(v1);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            previous = index;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordflow">return</span> clipped;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_vector.html">Vector&lt;int&gt;</a> triangulate_polygon(<span class="keyword">const</span> <a class="code" href="class_vector.html">Vector&lt;Vector2&gt;</a>&amp; p_polygon) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="class_vector.html">Vector&lt;int&gt;</a> triangles;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">if</span> (!Triangulate::triangulate(p_polygon,triangles))</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_vector.html">Vector&lt;int&gt;</a>(); <span class="comment">//fail</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">return</span> triangles;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_vector.html">Vector&lt; Vector&lt;Vector2&gt;</a> &gt; (*_decompose_func)(<span class="keyword">const</span> <a class="code" href="class_vector.html">Vector&lt;Vector2&gt;</a>&amp; p_polygon);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_vector.html">Vector&lt; Vector&lt;Vector2&gt;</a> &gt; decompose_polygon(<span class="keyword">const</span> <a class="code" href="class_vector.html">Vector&lt;Vector2&gt;</a>&amp; p_polygon) {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">if</span> (_decompose_func)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordflow">return</span> _decompose_func(p_polygon);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="class_vector.html">Vector&lt; Vector&lt;Vector2&gt;</a> &gt;();</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_d_vector.html">DVector&lt; DVector&lt; Face3 &gt;</a> &gt; separate_objects( <a class="code" href="class_d_vector.html">DVector&lt; Face3 &gt;</a> p_array );</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_d_vector.html">DVector&lt; Face3 &gt;</a> <a class="code" href="class_geometry.html#af5bb780c32128864930fea1212cf74f0">wrap_geometry</a>( <a class="code" href="class_d_vector.html">DVector&lt; Face3 &gt;</a> p_array, <span class="keywordtype">float</span> *p_error=NULL ); </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno"><a class="line" href="struct_geometry_1_1_mesh_data.html">  816</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_geometry_1_1_mesh_data.html">MeshData</a> {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        </div>
<div class="line"><a name="l00818"></a><span class="lineno"><a class="line" href="struct_geometry_1_1_mesh_data_1_1_face.html">  818</a></span>&#160;        <span class="keyword">struct </span><a class="code" href="struct_geometry_1_1_mesh_data_1_1_face.html">Face</a> {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <a class="code" href="class_plane.html">Plane</a> plane;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="class_vector.html">Vector&lt;int&gt;</a> indices;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        };</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <a class="code" href="class_vector.html">Vector&lt;Face&gt;</a> faces;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        </div>
<div class="line"><a name="l00825"></a><span class="lineno"><a class="line" href="struct_geometry_1_1_mesh_data_1_1_edge.html">  825</a></span>&#160;        <span class="keyword">struct </span><a class="code" href="struct_geometry_1_1_mesh_data_1_1_edge.html">Edge</a> {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="keywordtype">int</span> a,b;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        };</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <a class="code" href="class_vector.html">Vector&lt;Edge&gt;</a> edges;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <a class="code" href="class_vector.html">Vector&lt; Vector3 &gt;</a> vertices;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordtype">void</span> optimize_vertices();</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    };</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    _FORCE_INLINE_ <span class="keyword">static</span> <span class="keywordtype">int</span> get_uv84_normal_bit(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_vector) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordtype">int</span> lat = Math::fast_ftoi(Math::floor(Math::acos(p_vector.dot(<a class="code" href="struct_vector3.html">Vector3</a>(0,1,0)))*4.0/Math_PI+0.5));</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">if</span> (lat==0) {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="keywordflow">return</span> 24;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lat==4) {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">return</span> 25;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        }</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordtype">int</span> lon = Math::fast_ftoi(Math::floor( (Math_PI+Math::atan2(p_vector.x,p_vector.z))*8.0/(Math_PI*2.0) + 0.5))%8;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="keywordflow">return</span> lon+(lat-1)*8;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    _FORCE_INLINE_ <span class="keyword">static</span> <span class="keywordtype">int</span> get_uv84_normal_bit_neighbors(<span class="keywordtype">int</span> p_idx) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="keywordflow">if</span> (p_idx==24) {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            <span class="keywordflow">return</span> 1|2|4|8;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p_idx==25) {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="keywordflow">return</span> (1&lt;&lt;23)|(1&lt;&lt;22)|(1&lt;&lt;21)|(1&lt;&lt;20);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">if</span> ((p_idx%8) == 0)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                ret|=(1&lt;&lt;(p_idx+7));</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                ret|=(1&lt;&lt;(p_idx-1));</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keywordflow">if</span> ((p_idx%8) == 7)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                ret|=(1&lt;&lt;(p_idx-7));</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                ret|=(1&lt;&lt;(p_idx+1));</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="keywordtype">int</span> mask = ret|(1&lt;&lt;p_idx);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">if</span> (p_idx&lt;8)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                ret|=24;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                ret|=mask&gt;&gt;8;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            <span class="keywordflow">if</span> (p_idx&gt;=16)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                ret|=25;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                ret|=mask&lt;&lt;8;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keyword">static</span> MeshData build_convex_mesh(<span class="keyword">const</span> <a class="code" href="class_d_vector.html">DVector&lt;Plane&gt;</a> &amp;p_planes);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_d_vector.html">DVector&lt;Plane&gt;</a> build_sphere_planes(<span class="keywordtype">float</span> p_radius, <span class="keywordtype">int</span> p_lats, <span class="keywordtype">int</span> p_lons, Vector3::Axis p_axis=Vector3::AXIS_Z);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_d_vector.html">DVector&lt;Plane&gt;</a> build_box_planes(<span class="keyword">const</span> <a class="code" href="struct_vector3.html">Vector3</a>&amp; p_extents);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_d_vector.html">DVector&lt;Plane&gt;</a> build_cylinder_planes(<span class="keywordtype">float</span> p_radius, <span class="keywordtype">float</span> p_height, <span class="keywordtype">int</span> p_sides, Vector3::Axis p_axis=Vector3::AXIS_Z);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keyword">static</span> <a class="code" href="class_d_vector.html">DVector&lt;Plane&gt;</a> build_capsule_planes(<span class="keywordtype">float</span> p_radius, <span class="keywordtype">float</span> p_height, <span class="keywordtype">int</span> p_sides, <span class="keywordtype">int</span> p_lats, Vector3::Axis p_axis=Vector3::AXIS_Z);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> make_atlas(<span class="keyword">const</span> <a class="code" href="class_vector.html">Vector&lt;Size2i&gt;</a>&amp; p_rects,<a class="code" href="class_vector.html">Vector&lt;Point2i&gt;</a>&amp; r_result, <a class="code" href="struct_point2i.html">Size2i</a>&amp; r_size);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;};</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="ttc" id="class_geometry_html_af5bb780c32128864930fea1212cf74f0"><div class="ttname"><a href="class_geometry.html#af5bb780c32128864930fea1212cf74f0">Geometry::wrap_geometry</a></div><div class="ttdeci">static DVector&lt; Face3 &gt; wrap_geometry(DVector&lt; Face3 &gt; p_array, float *p_error=NULL)</div><div class="ttdoc">create a "wrap" that encloses the given geometry </div><div class="ttdef"><b>Definition:</b> geometry.cpp:583</div></div>
<div class="ttc" id="struct_point2i_html"><div class="ttname"><a href="struct_point2i.html">Point2i</a></div><div class="ttdef"><b>Definition:</b> math_2d.h:369</div></div>
<div class="ttc" id="struct_geometry_1_1_mesh_data_1_1_face_html"><div class="ttname"><a href="struct_geometry_1_1_mesh_data_1_1_face.html">Geometry::MeshData::Face</a></div><div class="ttdef"><b>Definition:</b> geometry.h:818</div></div>
<div class="ttc" id="struct_geometry_1_1_mesh_data_1_1_edge_html"><div class="ttname"><a href="struct_geometry_1_1_mesh_data_1_1_edge.html">Geometry::MeshData::Edge</a></div><div class="ttdef"><b>Definition:</b> geometry.h:825</div></div>
<div class="ttc" id="struct_geometry_1_1_mesh_data_html"><div class="ttname"><a href="struct_geometry_1_1_mesh_data.html">Geometry::MeshData</a></div><div class="ttdef"><b>Definition:</b> geometry.h:816</div></div>
<div class="ttc" id="struct_vector3_html"><div class="ttname"><a href="struct_vector3.html">Vector3</a></div><div class="ttdef"><b>Definition:</b> vector3.h:38</div></div>
<div class="ttc" id="class_geometry_html"><div class="ttname"><a href="class_geometry.html">Geometry</a></div><div class="ttdef"><b>Definition:</b> geometry.h:44</div></div>
<div class="ttc" id="struct_vector2_html"><div class="ttname"><a href="struct_vector2.html">Vector2</a></div><div class="ttdef"><b>Definition:</b> math_2d.h:65</div></div>
<div class="ttc" id="class_plane_html"><div class="ttname"><a href="class_plane.html">Plane</a></div><div class="ttdef"><b>Definition:</b> plane.h:35</div></div>
<div class="ttc" id="arch_8h_html_a996f7be338ccb40d1a2a5abc1ad61759"><div class="ttname"><a href="arch_8h.html#a996f7be338ccb40d1a2a5abc1ad61759">ABS</a></div><div class="ttdeci">#define ABS(x)</div><div class="ttdef"><b>Definition:</b> arch.h:91</div></div>
<div class="ttc" id="class_d_vector_html"><div class="ttname"><a href="class_d_vector.html">DVector</a></div><div class="ttdef"><b>Definition:</b> dvector.h:43</div></div>
<div class="ttc" id="class_vector_html"><div class="ttname"><a href="class_vector.html">Vector&lt; Vector3 &gt;</a></div></div>
<div class="ttc" id="class_geometry_html_a0360ea9aa69ddd199d8fe0dc77938b80"><div class="ttname"><a href="class_geometry.html#a0360ea9aa69ddd199d8fe0dc77938b80">Geometry::triangle_sphere_intersection_test</a></div><div class="ttdeci">static bool triangle_sphere_intersection_test(const Vector3 *p_triangle, const Vector3 &amp;p_normal, const Vector3 &amp;p_sphere_pos, real_t p_sphere_radius, Vector3 &amp;r_triangle_contact, Vector3 &amp;r_sphere_contact)</div><div class="ttdef"><b>Definition:</b> geometry.h:596</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 21 2015 13:24:02 for Godot by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
