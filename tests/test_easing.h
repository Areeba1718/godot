/*************************************************************************/
/*  test_easing.h                                                        */
/*************************************************************************/
/*                       This file is part of:                           */
/*                           GODOT ENGINE                                */
/*                      https://godotengine.org                          */
/*************************************************************************/
/* Copyright (c) 2007-2020 Juan Linietsky, Ariel Manzur.                 */
/* Copyright (c) 2014-2020 Godot Engine contributors (cf. AUTHORS.md).   */
/*                                                                       */
/* Permission is hereby granted, free of charge, to any person obtaining */
/* a copy of this software and associated documentation files (the       */
/* "Software"), to deal in the Software without restriction, including   */
/* without limitation the rights to use, copy, modify, merge, publish,   */
/* distribute, sublicense, and/or sell copies of the Software, and to    */
/* permit persons to whom the Software is furnished to do so, subject to */
/* the following conditions:                                             */
/*                                                                       */
/* The above copyright notice and this permission notice shall be        */
/* included in all copies or substantial portions of the Software.       */
/*                                                                       */
/* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,       */
/* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF    */
/* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.*/
/* IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY  */
/* CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,  */
/* TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE     */
/* SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.                */
/*************************************************************************/

#ifndef TEST_EASING_H
#define TEST_EASING_H

#include "scene/animation/tween.h"

namespace TestEasing {

class MockTween : public Tween {
public:
	real_t run_equation(TransitionType p_trans_type, EaseType p_ease_type, real_t t, real_t b, real_t c, real_t d) {
		return Tween::_run_equation(p_trans_type, p_ease_type, t, b, c, d);
	}
};

const float TIME_START = 0;
const float TIME_END = 1;
const int STEPS = 30;

/* clang-format off */
const float expected[Tween::TRANS_COUNT][Tween::EASE_COUNT][STEPS+1] = {
	{
		{300.000000,316.666656,333.333344,350.000000,366.666687,383.333344,400.000000,416.666687,433.333344,450.000000,466.666687,483.333344,500.000000,516.666687,533.333374,550.000000,566.666687,583.333374,600.000000,616.666687,633.333374,650.000000,666.666687,683.333374,700.000000,716.666687,733.333374,750.000000,766.666687,783.333374,800.000000,},
		{300.000000,316.666656,333.333344,350.000000,366.666687,383.333344,400.000000,416.666687,433.333344,450.000000,466.666687,483.333344,500.000000,516.666687,533.333374,550.000000,566.666687,583.333374,600.000000,616.666687,633.333374,650.000000,666.666687,683.333374,700.000000,716.666687,733.333374,750.000000,766.666687,783.333374,800.000000,},
		{300.000000,316.666656,333.333344,350.000000,366.666687,383.333344,400.000000,416.666687,433.333344,450.000000,466.666687,483.333344,500.000000,516.666687,533.333374,550.000000,566.666687,583.333374,600.000000,616.666687,633.333374,650.000000,666.666687,683.333374,700.000000,716.666687,733.333374,750.000000,766.666687,783.333374,800.000000,},
		{300.000000,316.666656,333.333344,350.000000,366.666687,383.333344,400.000000,416.666687,433.333344,450.000000,466.666687,483.333344,500.000000,516.666687,533.333374,550.000000,566.666687,583.333374,600.000000,616.666687,633.333374,650.000000,666.666687,683.333374,700.000000,716.666687,733.333374,750.000000,766.666687,783.333374,800.000000,},
	},
	{
		{300.000000,300.685242,302.739044,306.155823,310.926178,317.037079,324.471771,333.209808,343.227295,354.496735,366.987305,380.664734,395.491516,411.427032,428.427612,446.446625,465.434723,485.339844,506.107422,527.680542,550.000000,573.004761,596.631714,620.816040,645.491577,670.590515,696.044250,721.782837,747.735840,773.832031,800.000000,},
		{300.000000,326.167969,352.264221,378.217255,403.955872,429.409515,454.508514,479.183990,503.368347,526.995239,550.000000,572.319519,593.892639,614.660217,634.565308,653.553345,671.572449,688.572998,704.508545,719.335327,733.012695,745.503296,756.772705,766.790222,775.528259,782.962891,789.073853,793.844177,797.260986,799.314758,800.000000,},
		{300.000000,301.369507,305.463104,312.235870,321.613647,333.493652,347.745758,364.213806,382.717346,403.053711,425.000000,448.315857,472.745789,498.022095,523.867920,550.000000,576.132202,601.977966,627.254272,651.684204,675.000000,696.946411,717.282715,735.786255,752.254272,766.506348,778.386414,787.764160,794.536926,798.630493,800.000000,},
		{300.000000,326.132111,351.977936,377.254272,401.684174,425.000000,446.946320,467.282654,485.786224,502.254272,516.506348,528.386353,537.764160,544.536926,548.630493,550.000000,551.369507,555.463135,562.235901,571.613647,583.493652,597.745789,614.213806,632.717407,653.053711,675.000000,698.315918,722.745789,748.022156,773.867920,800.000000,},
	},
	{
		{300.000000,300.000031,300.000671,300.005005,300.021057,300.064301,300.160004,300.345825,300.674225,301.214996,302.057617,303.313812,305.119995,307.639771,311.066345,315.625000,321.575653,329.215179,338.880005,350.948547,365.843628,384.035034,406.041809,432.435089,463.840088,500.938843,544.472839,595.245056,654.122925,722.040161,800.000000,},
		{300.000000,377.959961,445.877197,504.755035,555.527222,599.061218,636.160034,667.565002,693.958191,715.965027,734.156372,749.051453,761.119995,770.784851,778.424377,784.375000,788.933655,792.360229,794.880005,796.686218,797.942383,798.784973,799.325745,799.654175,799.840027,799.935730,799.978943,799.994995,799.999329,800.000000,800.000000,},
		{300.000000,300.000336,300.010529,300.079987,300.337128,301.028809,302.559998,305.533173,310.787811,319.440002,332.921814,353.020905,381.920044,422.236420,477.061462,550.000000,622.938660,677.763672,718.080017,746.979126,767.078186,780.559998,789.212158,794.466858,797.440002,798.971191,799.662903,799.919983,799.989441,799.999695,800.000000,},
		{300.000000,372.938599,427.763611,468.080017,496.979095,517.078186,530.559998,539.212158,544.466858,547.440002,548.971191,549.662903,549.919983,549.989441,549.999695,550.000000,550.000305,550.010559,550.080017,550.337097,551.028809,552.559998,555.533142,560.787842,569.440002,582.921814,603.020935,631.920044,672.236450,727.061462,800.000000,},
	},
	{
		{300.000000,300.000610,300.009888,300.049988,300.158020,300.385803,300.799988,301.482086,302.528381,304.049988,306.172852,309.037659,312.800018,317.630249,323.713593,331.250000,340.454315,351.556183,364.800018,380.445099,398.765442,420.050018,444.602478,472.741394,504.800079,541.126587,582.084045,628.050049,679.417358,736.593262,800.000000,},
		{300.000000,363.406830,420.582703,471.950043,517.916016,558.873474,595.200073,627.258667,655.397522,679.950012,701.234619,719.554932,735.200012,748.443848,759.545715,768.750000,776.286438,782.369751,787.200012,790.962341,793.827148,795.950012,797.471619,798.517883,799.200012,799.614197,799.841980,799.950012,799.990112,799.999390,800.000000,},
		{300.000000,300.004944,300.079010,300.399994,301.264191,303.086426,306.399994,311.856781,320.227173,332.399994,349.382721,372.301239,402.400024,441.042023,489.708679,550.000000,610.291382,658.958069,697.600037,727.698792,750.617310,767.600037,779.772827,788.143188,793.600037,796.913574,798.735779,799.599976,799.920959,799.995056,800.000000,},
		{300.000000,360.291351,408.958008,447.600037,477.698761,500.617310,517.600037,529.772827,538.143188,543.599976,546.913574,548.735779,549.599976,549.920959,549.995056,550.000000,550.004944,550.079041,550.400024,551.264221,553.086426,556.400024,561.856812,570.227173,582.400024,599.382751,622.301270,652.400024,691.042053,739.708679,800.000000,},
	},
	{
		{300.000000,300.555542,302.222229,305.000000,308.888885,313.888885,320.000000,327.222229,335.555573,345.000000,355.555573,367.222229,380.000000,393.888916,408.888916,425.000000,442.222229,460.555573,480.000000,500.555603,522.222229,545.000061,568.888916,593.888916,620.000061,647.222229,675.555603,705.000061,735.555603,767.222229,800.000000,},
		{300.000000,332.777771,364.444458,395.000000,424.444458,452.777771,480.000000,506.111115,531.111145,555.000000,577.777771,599.444458,620.000000,639.444458,657.777771,675.000000,691.111145,706.111145,720.000000,732.777771,744.444458,755.000000,764.444458,772.777832,780.000000,786.111084,791.111084,795.000000,797.777771,799.444458,800.000000,},
		{300.000000,301.111115,304.444458,310.000000,317.777771,327.777771,340.000000,354.444458,371.111115,390.000000,411.111115,434.444458,460.000031,487.777802,517.777832,550.000000,582.222229,612.222290,640.000000,665.555542,688.888916,710.000000,728.888916,745.555542,760.000000,772.222229,782.222290,790.000000,795.555542,798.888916,800.000000,},
		{300.000000,332.222229,362.222229,390.000000,415.555573,438.888885,460.000000,478.888885,495.555573,510.000000,522.222229,532.222229,540.000000,545.555542,548.888916,550.000000,551.111084,554.444458,560.000000,567.777771,577.777771,590.000000,604.444458,621.111145,640.000061,661.111145,684.444519,710.000000,737.777832,767.777832,800.000000,},
	},
	{
		{300.000000,300.115204,300.275085,300.476562,300.730377,301.050201,301.453125,301.960785,302.600403,303.406250,304.421570,305.700775,307.312500,309.343140,311.901581,315.125000,319.186279,324.303162,330.750000,338.872559,349.106293,362.000031,378.245087,398.712585,424.500061,456.990173,497.925232,549.500061,614.480408,696.350342,799.500000,},
		{300.000000,403.252899,485.204773,550.250000,601.876465,642.852417,675.375000,701.188232,721.676208,737.937500,750.844116,761.088074,769.218750,775.672058,780.794067,784.859375,788.086060,790.647034,792.679688,794.293030,795.573486,796.589844,797.396484,798.036743,798.544922,798.948242,799.268372,799.522461,799.724121,799.884216,800.000000,},
		{300.000000,300.137543,300.365204,300.726562,301.300201,302.210785,303.656250,305.950775,309.593140,315.375000,324.553162,339.122528,362.250031,398.962616,457.240204,550.125000,642.681213,700.987915,737.718750,760.857788,775.434448,784.617188,790.401978,794.046143,796.341797,797.787964,798.699036,799.272949,799.634521,799.862244,800.000000,},
		{300.000000,392.602386,450.938232,487.687500,510.838104,525.422058,534.609375,540.397034,544.043030,546.339844,547.786743,548.698242,549.272461,549.634216,549.862061,550.000000,550.137573,550.365173,550.726562,551.300171,552.210754,553.656250,555.950806,559.593140,565.375000,574.553162,589.122559,612.250061,648.962646,707.240173,799.750000,},
	},
	{
		{300.000000,300.106842,300.593750,300.976562,300.942535,300.269196,299.023438,297.687622,297.086578,298.046875,300.854614,304.750092,307.812500,307.540283,302.153503,292.187500,281.500946,276.692688,284.375031,306.837006,338.000641,362.500031,360.322205,317.227966,237.499786,152.007614,113.541367,175.000122,354.696167,604.005188,800.000000,},
		{300.000000,495.995056,745.304260,925.000000,986.458618,947.992310,862.499939,782.771912,739.677795,737.500000,761.999390,793.163086,815.625000,823.307312,818.499023,807.812500,797.846497,792.459717,792.187500,795.249939,799.145386,801.953125,802.913391,802.312378,800.976562,799.730835,799.057434,799.023438,799.406250,799.893188,800.000000,},
		{300.000000,300.346313,300.549774,300.169586,298.936188,297.555847,298.046875,302.455994,309.577820,311.969452,298.557831,267.104736,241.269196,271.545563,394.046722,550.000000,705.953552,828.454590,858.730774,832.895203,801.442139,788.030518,790.422180,797.544006,801.953125,802.444153,801.063843,799.830444,799.450256,799.653687,800.000000,},
		{300.000000,522.652100,643.229309,581.250000,519.838867,530.999695,557.812500,559.249512,548.923218,546.093750,549.572693,551.456726,550.488281,549.528748,549.703125,550.000000,550.296875,550.471252,549.511719,548.543274,550.427307,553.906250,551.076721,540.750488,542.187561,569.000366,580.161072,518.749878,456.770691,577.348083,800.000000,},
	},
	{
		{300.000000,300.018524,300.148163,300.500000,301.185181,302.314819,304.000000,306.351868,309.481476,313.500000,318.518524,324.648163,332.000000,340.685181,350.814819,362.500000,375.851868,390.981506,408.000000,427.018555,448.148163,471.500031,497.185211,525.314819,556.000061,589.351929,625.481567,664.500000,706.518555,751.648193,800.000000,},
		{300.000000,348.351929,393.481476,435.500061,474.518494,510.648193,544.000061,574.685181,602.814819,628.500000,651.851868,672.981445,692.000000,709.018555,724.148132,737.500000,749.185181,759.314819,768.000000,775.351868,781.481506,786.500000,790.518555,793.648132,796.000000,797.685181,798.814819,799.500000,799.851868,799.981506,800.000000,},
		{300.000000,300.074066,300.592590,302.000000,304.740753,309.259247,316.000000,325.407410,337.925934,354.000000,374.074097,398.592590,428.000031,462.740784,503.259277,550.000000,596.740784,637.259277,672.000000,701.407471,725.925903,746.000000,762.074097,774.592590,784.000000,790.740723,795.259277,798.000000,799.407410,799.925903,800.000000,},
		{300.000000,346.740753,387.259247,422.000031,451.407410,475.925934,496.000000,512.074097,524.592590,534.000000,540.740723,545.259277,548.000000,549.407410,549.925903,550.000000,550.074097,550.592590,552.000000,554.740723,559.259277,566.000000,575.407410,587.925964,604.000061,624.074097,648.592651,678.000000,712.740845,753.259277,800.000000,},
	},
	{
		{300.000000,300.277832,301.112335,302.506287,304.464386,306.993347,310.102051,313.801605,318.105591,323.030396,328.595490,334.823792,341.742432,349.383179,357.783356,366.987305,377.047424,388.026459,400.000000,413.060486,427.322021,442.928589,460.065369,478.977356,500.000061,523.614624,550.556213,582.055054,620.494629,671.980957,800.000000,},
		{300.000000,428.019165,479.505493,517.944946,549.443787,576.385376,600.000000,621.022705,639.934692,657.071411,672.677979,686.939575,700.000000,711.973572,722.952637,733.012695,742.216675,750.616821,758.257568,765.176208,771.404541,776.969604,781.894409,786.198364,789.897949,793.006653,795.535645,797.493713,798.887695,799.722168,800.000000,},
		{300.000000,300.556183,302.232208,305.051025,309.052795,314.297729,320.871216,328.891693,338.523712,350.000000,363.661011,380.032684,400.000031,425.278107,460.247314,550.000000,639.752808,674.721924,700.000000,719.967346,736.338989,750.000000,761.476318,771.108276,779.128784,785.702271,790.947205,794.948975,797.767822,799.443848,800.000000,},
		{300.000000,389.752747,424.721893,450.000000,469.967346,486.338989,500.000000,511.476318,521.108337,529.128784,535.702271,540.947205,544.948975,547.767822,549.443848,550.000000,550.556213,552.232178,555.051025,559.052795,564.297729,570.871216,578.891663,588.523743,600.000000,613.661011,630.032715,650.000000,675.278137,710.247314,800.000000,},
	},
	{
		{300.000000,307.256958,306.111115,305.937531,322.361115,330.381958,330.000000,321.215271,304.027771,334.687531,369.444489,395.798615,413.750000,423.298615,424.444458,417.187500,401.527740,377.465210,344.999969,304.131866,379.861176,459.687622,531.111145,594.132019,648.750122,694.965332,732.777832,762.187500,783.194458,795.798584,800.000000,},
		{300.000000,304.201385,316.805542,337.812500,367.222229,405.034729,451.250031,505.868103,568.888916,640.312500,720.138916,795.868042,755.000000,722.534668,698.472229,682.812500,675.555542,676.701416,686.250000,704.201416,730.555542,765.312500,795.972229,778.784668,770.000000,769.618042,777.638916,794.062500,793.888916,792.743042,800.000000,},
		{300.000000,303.055542,311.180542,315.000000,302.013885,334.722229,356.875000,362.222229,350.763855,322.500000,339.930603,415.555573,474.375061,516.388916,541.597229,550.000000,558.402771,583.611145,625.625061,684.444580,760.069519,777.500000,749.236084,737.777771,743.125000,765.277832,797.986084,785.000000,788.819458,796.944458,800.000000,},
		{300.000000,308.402771,333.611115,375.625000,434.444458,510.069458,527.500000,499.236115,487.777771,493.125000,515.277771,547.986084,535.000000,538.819458,546.944458,550.000000,553.055542,561.180542,565.000000,552.013855,584.722229,606.875000,612.222229,600.763855,572.499939,589.930664,665.555664,724.375061,766.388916,791.597229,800.000000,},
	},
	{
		{300.000000,299.104706,296.618958,292.842896,288.076721,282.620605,276.774719,270.839233,265.114349,259.900238,255.497040,252.204956,250.324158,250.154831,251.997131,256.151245,262.917358,272.595642,285.486237,301.889374,322.105194,346.433899,375.175598,408.630615,447.098938,490.880829,540.276611,595.586121,657.109741,725.147705,800.000000,},
		{300.000000,374.852478,442.890259,504.414062,559.723511,609.119263,652.901123,691.369507,724.824402,753.566162,777.894836,798.110657,814.513794,827.404358,837.082642,843.848755,848.002869,849.845154,849.675842,847.795044,844.502991,840.099731,834.885620,829.160767,823.225220,817.379395,811.923218,807.157104,803.381104,800.895264,800.000000,},
		{300.000000,297.383057,290.597382,281.240723,270.910797,261.205383,253.722168,250.058929,251.813370,260.583252,277.966339,305.560303,344.962921,397.771973,465.585083,550.000000,634.415039,702.228210,755.037109,794.439819,822.033691,839.416809,848.186584,849.941040,846.277832,838.794617,829.089172,818.759277,809.402588,802.616943,800.000000,},
		{300.000000,371.445129,429.861755,476.450562,512.412231,538.947388,557.256897,568.541321,574.001465,574.837891,572.251465,567.442810,561.612610,555.961609,551.690552,550.000000,548.309448,544.038330,538.387329,532.557190,527.748535,525.162109,525.998535,531.458679,542.743164,561.052612,587.587891,623.549500,670.138306,728.554871,800.000000,},
	},
};
/* clang-format on */

TEST_CASE("[Easing] Test easing functions results") {
	MockTween tween;
	// Current time, initial_val, delta_val, duration
	float results[Tween::TRANS_COUNT][Tween::EASE_COUNT][STEPS + 1] = {};
	for (int tr = 0; tr < Tween::TRANS_COUNT; tr++) {
		for (int ease = 0; ease < Tween::EASE_COUNT; ease++) {
			for (int i = 0; i <= STEPS; i++) {
				Tween::TransitionType tt = (Tween::TransitionType)tr;
				Tween::EaseType et = (Tween::EaseType)ease;
				const float t = TIME_START + (TIME_END - TIME_START) / STEPS * i;
				real_t v = tween.run_equation(tt, et, t, 300, 500, TIME_END);
				results[tr][ease][i] = v;
			}
		}
	}
#if 0
	// Print the results array.
	// This can be used to re-create the "expected" array in case we know the test
	// will procuce a different result, and we want to update the test itself.
	// (e.g. changing steps, values, known behavior, etc).
	printf("{\n");
	for (int x = 0; x < Tween::TRANS_COUNT; x++) {
		printf("\t{\n");
		for (int y = 0; y < Tween::EASE_COUNT; y++) {
			printf("\t\t{");
			for (int z = 0; z <= STEPS; z++) {
				printf("%f,", results[x][y][z]);
			}
			printf("},\n");
		}
		printf("\t},\n");
	}
	printf("\n};\n");
#endif
	for (int x = 0; x < Tween::TRANS_COUNT; x++) {
		for (int y = 0; y < Tween::EASE_COUNT; y++) {
			for (int z = 0; z <= STEPS; z++) {
				const float r = results[x][y][z];
				const float e = expected[x][y][z];
				CHECK(Math::is_equal_approx(r, e));
			}
		}
	}
}
} // namespace TestEasing

#endif // TEST_EASING_H
